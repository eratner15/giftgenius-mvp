<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#FF69B4" />
    <meta name="description" content="GiftGenius - Find the perfect gift backed by real testimonials from men" />
    <title>GiftGenius - Gift Ideas That Actually Work</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #6B46C1;
            --primary-dark: #553C9A;
            --primary-light: #8B5CF6;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --info: #3B82F6;
            --light: #F3F4F6;
            --dark: #1F2937;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            background: white;
            min-height: 100vh;
            position: relative;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Hero Section with Enhanced Animation */
        .hero {
            text-align: center;
            padding: 50px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="grad" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:rgba(255,255,255,0.1);stop-opacity:1" /><stop offset="100%" style="stop-color:rgba(255,255,255,0);stop-opacity:0" /></radialGradient></defs><circle cx="20" cy="20" r="2" fill="url(%23grad)" opacity="0.6"><animate attributeName="cy" values="20;80;20" dur="4s" repeatCount="indefinite"/></circle><circle cx="80" cy="40" r="1" fill="url(%23grad)" opacity="0.4"><animate attributeName="cy" values="40;90;40" dur="6s" repeatCount="indefinite"/></circle><circle cx="60" cy="60" r="1.5" fill="url(%23grad)" opacity="0.5"><animate attributeName="cy" values="60;10;60" dur="5s" repeatCount="indefinite"/></circle></svg>') repeat;
            opacity: 0.3;
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(180deg); }
        }

        .hero h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
            animation: slideDown 0.8s ease-out;
        }

        .hero p {
            font-size: 1.3rem;
            opacity: 0.95;
            position: relative;
            z-index: 2;
            animation: slideUp 0.8s ease-out 0.2s both;
        }

        @keyframes slideDown {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .trust-indicators {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 25px;
            flex-wrap: wrap;
            position: relative;
            z-index: 2;
            animation: fadeIn 1s ease-out 0.4s both;
        }

        .trust-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .trust-indicator:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Enhanced Purchase Journey Sidebar */
        .purchase-journey-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
            transition: right 0.3s ease;
            z-index: 10000;
            overflow-y: auto;
        }

        .purchase-journey-sidebar.open {
            right: 0;
        }

        .sidebar-header {
            padding: 20px;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
        }

        .sidebar-content {
            padding: 0;
        }

        .sidebar-section {
            border-bottom: 1px solid var(--gray-200);
            padding: 20px;
        }

        .sidebar-section:last-child {
            border-bottom: none;
        }

        .sidebar-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Wishlist Management */
        .wishlist-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .wishlist-item:hover {
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(107, 70, 193, 0.1);
        }

        .wishlist-item-image {
            width: 60px;
            height: 60px;
            border-radius: 6px;
            object-fit: cover;
        }

        .wishlist-item-content {
            flex: 1;
        }

        .wishlist-item-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }

        .wishlist-item-price {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .wishlist-item-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .wishlist-action-btn {
            padding: 4px 8px;
            font-size: 12px;
            border: 1px solid var(--gray-300);
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .wishlist-action-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .wishlist-action-btn.primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Budget Tracker */
        .budget-tracker {
            background: var(--gray-50);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .budget-amount {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }

        .budget-progress {
            width: 100%;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .budget-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success) 0%, var(--warning) 70%, var(--danger) 100%);
            transition: width 0.3s ease;
        }

        .budget-suggestion {
            font-size: 0.85rem;
            color: var(--gray-600);
            font-style: italic;
        }

        /* Gift Planning Calendar */
        .gift-calendar {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 16px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .calendar-nav {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .calendar-nav:hover {
            background: var(--gray-100);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .calendar-day:hover {
            background: var(--gray-100);
        }

        .calendar-day.today {
            background: var(--primary);
            color: white;
        }

        .calendar-day.has-event {
            background: var(--warning);
            color: white;
        }

        .calendar-day.selected {
            background: var(--info);
            color: white;
        }

        .occasion-form {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--gray-200);
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            margin-bottom: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(107, 70, 193, 0.1);
        }

        /* Gift Comparison Modal */
        .comparison-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            padding: 20px;
        }

        .comparison-content {
            background: white;
            border-radius: 16px;
            max-width: 1000px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .comparison-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .comparison-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .comparison-item {
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .comparison-item.selected {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(107, 70, 193, 0.1);
        }

        .comparison-item-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .comparison-item-content {
            padding: 16px;
        }

        .comparison-item-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .comparison-item-price {
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 12px;
        }

        .comparison-pros-cons {
            margin-bottom: 12px;
        }

        .comparison-pros, .comparison-cons {
            margin-bottom: 8px;
        }

        .comparison-pros h5, .comparison-cons h5 {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .comparison-pros h5 {
            color: var(--success);
        }

        .comparison-cons h5 {
            color: var(--danger);
        }

        .comparison-list {
            list-style: none;
            font-size: 0.85rem;
        }

        .comparison-list li {
            padding: 2px 0;
            position: relative;
            padding-left: 16px;
        }

        .comparison-pros .comparison-list li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: 600;
        }

        .comparison-cons .comparison-list li::before {
            content: '√ó';
            position: absolute;
            left: 0;
            color: var(--danger);
            font-weight: 600;
        }

        .comparison-select-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .comparison-select-btn:hover {
            background: var(--primary-dark);
        }

        /* Analytics Dashboard */
        .analytics-dashboard {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            border: 2px solid var(--gray-100);
        }

        .analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .analytics-title {
            color: var(--primary);
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analytics-period {
            background: var(--gray-100);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .analytics-card {
            background: var(--gray-50);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .analytics-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .analytics-label {
            font-size: 0.9rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        .analytics-change {
            font-size: 0.8rem;
            margin-top: 5px;
            font-weight: 600;
        }

        .analytics-change.positive {
            color: var(--success);
        }

        .analytics-change.negative {
            color: var(--danger);
        }

        .analytics-chart {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 20px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-500);
            font-style: italic;
        }

        /* Floating Action Buttons */
        .floating-actions {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }

        .floating-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            background: var(--primary);
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(107, 70, 193, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(107, 70, 193, 0.4);
        }

        .floating-btn.secondary {
            background: var(--info);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .floating-btn.tertiary {
            background: var(--success);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* Enhanced Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            animation: slideInRight 0.3s ease-out;
            position: relative;
            overflow: hidden;
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.info {
            border-left: 4px solid var(--info);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
        }

        .toast::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 2px;
            background: var(--primary);
            animation: shrink 3s linear;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes shrink {
            from { width: 100%; }
            to { width: 0%; }
        }

        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .toast-message {
            font-size: 14px;
            color: var(--gray-600);
        }

        /* Continue with existing styles from Phase 2 - including all search, filters, recommendations, etc. */
        /* ... (keeping all existing Phase 2 styles) ... */

        /* Enhanced Mobile Optimization */
        @media (max-width: 768px) {
            .purchase-journey-sidebar {
                width: 100%;
                right: -100%;
            }

            .floating-actions {
                bottom: 15px;
                right: 15px;
                gap: 10px;
            }

            .floating-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .comparison-modal {
                padding: 10px;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
                padding: 15px;
            }

            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .analytics-value {
                font-size: 1.5rem;
            }

            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
            }

            .toast {
                min-width: auto;
                width: 100%;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script>
        // Enhanced Toast System
        let toastId = 0;
        const toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container';
        document.body.appendChild(toastContainer);

        function showToast(title, message, type = 'info') {
            const toast = document.createElement('div');
            const id = ++toastId;

            const icons = {
                success: '‚úÖ',
                info: 'üí°',
                warning: '‚ö†Ô∏è',
                error: '‚ùå'
            };

            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.info}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;

            toastContainer.appendChild(toast);

            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideInRight 0.3s ease-out reverse';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }
            }, 3000);
        }

        // Data URL configuration
        const DATA_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3001'
            : './full-data.json';

        const { useState, useEffect, Fragment, useRef } = React;

        // Enhanced Analytics & Conversion Tracking
        class ConversionAnalytics {
            constructor() {
                this.data = this.loadData();
                this.sessionStart = Date.now();
                this.events = [];
            }

            loadData() {
                const saved = localStorage.getItem('giftgenius_conversion_analytics');
                return saved ? JSON.parse(saved) : {
                    sessions: 0,
                    pageViews: 0,
                    giftViews: 0,
                    wishlistAdds: 0,
                    comparisons: 0,
                    externalClicks: 0,
                    budgetSets: 0,
                    occasionsPlanned: 0,
                    avgSessionTime: 0,
                    conversionFunnel: {
                        visitors: 0,
                        giftViewers: 0,
                        wishlisters: 0,
                        comparers: 0,
                        clickers: 0
                    },
                    dailyStats: {},
                    popularGifts: {},
                    searchTerms: {},
                    categoryPreferences: {}
                };
            }

            saveData() {
                localStorage.setItem('giftgenius_conversion_analytics', JSON.stringify(this.data));
            }

            trackEvent(eventType, data = {}) {
                const event = {
                    type: eventType,
                    timestamp: Date.now(),
                    sessionTime: Date.now() - this.sessionStart,
                    data
                };

                this.events.push(event);
                this.updateMetrics(eventType, data);
                this.saveData();
            }

            updateMetrics(eventType, data) {
                const today = new Date().toISOString().split('T')[0];

                if (!this.data.dailyStats[today]) {
                    this.data.dailyStats[today] = {
                        sessions: 0,
                        giftViews: 0,
                        wishlistAdds: 0,
                        comparisons: 0,
                        externalClicks: 0
                    };
                }

                switch (eventType) {
                    case 'session_start':
                        this.data.sessions++;
                        this.data.dailyStats[today].sessions++;
                        this.data.conversionFunnel.visitors++;
                        break;
                    case 'gift_view':
                        this.data.giftViews++;
                        this.data.dailyStats[today].giftViews++;
                        this.data.conversionFunnel.giftViewers++;
                        if (data.giftId) {
                            this.data.popularGifts[data.giftId] = (this.data.popularGifts[data.giftId] || 0) + 1;
                        }
                        break;
                    case 'wishlist_add':
                        this.data.wishlistAdds++;
                        this.data.dailyStats[today].wishlistAdds++;
                        this.data.conversionFunnel.wishlisters++;
                        break;
                    case 'comparison_start':
                        this.data.comparisons++;
                        this.data.dailyStats[today].comparisons++;
                        this.data.conversionFunnel.comparers++;
                        break;
                    case 'external_click':
                        this.data.externalClicks++;
                        this.data.dailyStats[today].externalClicks++;
                        this.data.conversionFunnel.clickers++;
                        break;
                    case 'budget_set':
                        this.data.budgetSets++;
                        break;
                    case 'occasion_planned':
                        this.data.occasionsPlanned++;
                        break;
                    case 'search':
                        if (data.query) {
                            this.data.searchTerms[data.query.toLowerCase()] =
                                (this.data.searchTerms[data.query.toLowerCase()] || 0) + 1;
                        }
                        break;
                }
            }

            getConversionRates() {
                const funnel = this.data.conversionFunnel;
                return {
                    viewToWishlist: funnel.visitors > 0 ? (funnel.wishlisters / funnel.visitors * 100).toFixed(1) : 0,
                    wishlistToComparison: funnel.wishlisters > 0 ? (funnel.comparers / funnel.wishlisters * 100).toFixed(1) : 0,
                    comparisonToClick: funnel.comparers > 0 ? (funnel.clickers / funnel.comparers * 100).toFixed(1) : 0,
                    overallConversion: funnel.visitors > 0 ? (funnel.clickers / funnel.visitors * 100).toFixed(1) : 0
                };
            }

            getDailyGrowth() {
                const dates = Object.keys(this.data.dailyStats).sort();
                if (dates.length < 2) return { sessions: 0, giftViews: 0, conversions: 0 };

                const today = dates[dates.length - 1];
                const yesterday = dates[dates.length - 2];

                const todayStats = this.data.dailyStats[today] || {};
                const yesterdayStats = this.data.dailyStats[yesterday] || {};

                return {
                    sessions: this.calculateGrowth(todayStats.sessions || 0, yesterdayStats.sessions || 0),
                    giftViews: this.calculateGrowth(todayStats.giftViews || 0, yesterdayStats.giftViews || 0),
                    conversions: this.calculateGrowth(todayStats.externalClicks || 0, yesterdayStats.externalClicks || 0)
                };
            }

            calculateGrowth(current, previous) {
                if (previous === 0) return current > 0 ? 100 : 0;
                return ((current - previous) / previous * 100).toFixed(1);
            }
        }

        // Gift Planning & Calendar System
        class GiftPlanner {
            constructor() {
                this.occasions = this.loadOccasions();
            }

            loadOccasions() {
                const saved = localStorage.getItem('giftgenius_occasions');
                return saved ? JSON.parse(saved) : {};
            }

            saveOccasions() {
                localStorage.setItem('giftgenius_occasions', JSON.stringify(this.occasions));
            }

            addOccasion(date, title, budget = null, notes = '') {
                const dateKey = date.toISOString().split('T')[0];
                this.occasions[dateKey] = {
                    title,
                    budget,
                    notes,
                    created: Date.now(),
                    giftIds: []
                };
                this.saveOccasions();
            }

            getOccasions(month, year) {
                const monthStr = `${year}-${String(month + 1).padStart(2, '0')}`;
                return Object.entries(this.occasions)
                    .filter(([date]) => date.startsWith(monthStr))
                    .map(([date, occasion]) => ({ date, ...occasion }));
            }

            addGiftToOccasion(date, giftId) {
                const dateKey = date.toISOString().split('T')[0];
                if (this.occasions[dateKey]) {
                    if (!this.occasions[dateKey].giftIds.includes(giftId)) {
                        this.occasions[dateKey].giftIds.push(giftId);
                        this.saveOccasions();
                    }
                }
            }
        }

        // Budget Tracking System
        class BudgetTracker {
            constructor() {
                this.budget = this.loadBudget();
            }

            loadBudget() {
                const saved = localStorage.getItem('giftgenius_budget');
                return saved ? JSON.parse(saved) : {
                    total: 0,
                    spent: 0,
                    wishlistTotal: 0,
                    categories: {},
                    lastUpdated: null
                };
            }

            saveBudget() {
                this.budget.lastUpdated = Date.now();
                localStorage.setItem('giftgenius_budget', JSON.stringify(this.budget));
            }

            setBudget(amount) {
                this.budget.total = amount;
                this.saveBudget();
            }

            addToWishlist(giftPrice, category = 'general') {
                this.budget.wishlistTotal += giftPrice;
                this.budget.categories[category] = (this.budget.categories[category] || 0) + giftPrice;
                this.saveBudget();
            }

            removeFromWishlist(giftPrice, category = 'general') {
                this.budget.wishlistTotal = Math.max(0, this.budget.wishlistTotal - giftPrice);
                this.budget.categories[category] = Math.max(0, (this.budget.categories[category] || 0) - giftPrice);
                this.saveBudget();
            }

            getBudgetStatus() {
                const remaining = this.budget.total - this.budget.wishlistTotal;
                const percentUsed = this.budget.total > 0 ? (this.budget.wishlistTotal / this.budget.total) * 100 : 0;

                let status = 'good';
                let suggestion = 'You\'re within budget!';

                if (percentUsed > 100) {
                    status = 'over';
                    suggestion = 'You\'re over budget. Consider removing some items.';
                } else if (percentUsed > 80) {
                    status = 'warning';
                    suggestion = 'Almost at your budget limit.';
                } else if (percentUsed > 60) {
                    status = 'caution';
                    suggestion = 'Getting close to your budget.';
                }

                return {
                    total: this.budget.total,
                    spent: this.budget.wishlistTotal,
                    remaining,
                    percentUsed,
                    status,
                    suggestion
                };
            }
        }

        function App() {
            // Existing state from Phase 2
            const [gifts, setGifts] = useState([]);
            const [allGifts, setAllGifts] = useState([]);
            const [selectedGift, setSelectedGift] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [favorites, setFavorites] = useState([]);
            const [sortBy, setSortBy] = useState('personalized');

            // Phase 3: Enhanced Purchase Journey
            const [wishlist, setWishlist] = useState([]);
            const [showPurchaseJourney, setShowPurchaseJourney] = useState(false);
            const [showComparison, setShowComparison] = useState(false);
            const [comparisonGifts, setComparisonGifts] = useState([]);
            const [selectedCalendarDate, setSelectedCalendarDate] = useState(null);
            const [currentCalendarMonth, setCurrentCalendarMonth] = useState(new Date().getMonth());
            const [currentCalendarYear, setCurrentCalendarYear] = useState(new Date().getFullYear());

            // Analytics & Conversion Tracking
            const [analytics] = useState(() => new ConversionAnalytics());
            const [giftPlanner] = useState(() => new GiftPlanner());
            const [budgetTracker] = useState(() => new BudgetTracker());
            const [analyticsData, setAnalyticsData] = useState({});
            const [budgetStatus, setBudgetStatus] = useState({});

            // Existing Phase 2 state
            const [filter, setFilter] = useState({
                category: '',
                maxPrice: 1000,
                minSuccessRate: 0,
                search: '',
                quickFilter: ''
            });

            useEffect(() => {
                analytics.trackEvent('session_start');
                loadWishlist();
                updateAnalytics();
                updateBudgetStatus();
                fetchGifts();
            }, []);

            const loadWishlist = () => {
                const saved = localStorage.getItem('giftgenius_wishlist');
                if (saved) setWishlist(JSON.parse(saved));
            };

            const updateAnalytics = () => {
                setAnalyticsData({
                    ...analytics.data,
                    conversionRates: analytics.getConversionRates(),
                    dailyGrowth: analytics.getDailyGrowth()
                });
            };

            const updateBudgetStatus = () => {
                setBudgetStatus(budgetTracker.getBudgetStatus());
            };

            const addToWishlist = (gift) => {
                const isAlreadyInWishlist = wishlist.some(item => item.id === gift.id);

                if (!isAlreadyInWishlist) {
                    const newWishlist = [...wishlist, { ...gift, addedAt: Date.now() }];
                    setWishlist(newWishlist);
                    localStorage.setItem('giftgenius_wishlist', JSON.stringify(newWishlist));

                    budgetTracker.addToWishlist(gift.price, gift.category);
                    updateBudgetStatus();

                    analytics.trackEvent('wishlist_add', { giftId: gift.id, price: gift.price });
                    updateAnalytics();

                    showToast(
                        'Added to Wishlist!',
                        `${gift.name || gift.title} saved for later`,
                        'success'
                    );
                } else {
                    showToast(
                        'Already in Wishlist',
                        'This gift is already saved',
                        'info'
                    );
                }
            };

            const removeFromWishlist = (giftId) => {
                const gift = wishlist.find(item => item.id === giftId);
                if (gift) {
                    const newWishlist = wishlist.filter(item => item.id !== giftId);
                    setWishlist(newWishlist);
                    localStorage.setItem('giftgenius_wishlist', JSON.stringify(newWishlist));

                    budgetTracker.removeFromWishlist(gift.price, gift.category);
                    updateBudgetStatus();

                    showToast(
                        'Removed from Wishlist',
                        `${gift.name || gift.title} removed`,
                        'info'
                    );
                }
            };

            const startComparison = (gift) => {
                const newComparison = [gift];

                // Add similar gifts automatically
                const similarGifts = allGifts
                    .filter(g => g.id !== gift.id && g.category === gift.category)
                    .sort((a, b) => Math.abs(a.price - gift.price) - Math.abs(b.price - gift.price))
                    .slice(0, 2);

                newComparison.push(...similarGifts);
                setComparisonGifts(newComparison);
                setShowComparison(true);

                analytics.trackEvent('comparison_start', {
                    primaryGift: gift.id,
                    similarGifts: similarGifts.map(g => g.id)
                });
                updateAnalytics();

                showToast(
                    'Comparison Started',
                    'Compare similar gifts side by side',
                    'info'
                );
            };

            const setBudget = (amount) => {
                budgetTracker.setBudget(amount);
                updateBudgetStatus();
                analytics.trackEvent('budget_set', { amount });
                updateAnalytics();

                showToast(
                    'Budget Set',
                    `Your gift budget is now $${amount}`,
                    'success'
                );
            };

            const handleExternalClick = (gift) => {
                analytics.trackEvent('external_click', {
                    giftId: gift.id,
                    price: gift.price,
                    category: gift.category
                });
                updateAnalytics();

                showToast(
                    'Redirecting...',
                    'Taking you to purchase this gift',
                    'info'
                );
            };

            const fetchGifts = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(DATA_URL);
                    if (!response.ok) throw new Error('Failed to fetch gifts');
                    const data = await response.json();

                    const giftsData = data.gifts || [];
                    setAllGifts(giftsData);
                    setGifts(giftsData);

                    showToast(
                        'Gifts Loaded!',
                        `Found ${giftsData.length} amazing gifts for you`,
                        'success'
                    );
                } catch (error) {
                    setError(error.message);
                    showToast(
                        'Error Loading Gifts',
                        'Please check your connection and try again',
                        'error'
                    );
                } finally {
                    setLoading(false);
                }
            };

            const handleGiftClick = (gift) => {
                analytics.trackEvent('gift_view', { giftId: gift.id });
                updateAnalytics();
                setSelectedGift(gift);
            };

            if (loading) {
                return (
                    <div className="app-container">
                        <div className="container">
                            <div style={{ textAlign: 'center', padding: '60px 20px' }}>
                                <div style={{ fontSize: '3rem', marginBottom: '20px' }}>üéÅ</div>
                                <h2>Loading amazing gifts...</h2>
                            </div>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="app-container">
                        <div className="container">
                            <div style={{ textAlign: 'center', padding: '60px 20px' }}>
                                <div style={{ fontSize: '3rem', marginBottom: '20px' }}>üòî</div>
                                <h2>Oops! Something went wrong</h2>
                                <p style={{ color: 'var(--gray-600)', marginBottom: '20px' }}>{error}</p>
                                <button
                                    onClick={fetchGifts}
                                    style={{
                                        padding: '12px 24px',
                                        background: 'var(--primary)',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '8px',
                                        cursor: 'pointer'
                                    }}
                                >
                                    Try Again
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="app-container">
                    {/* Hero Section */}
                    <section className="hero">
                        <div className="container">
                            <h1>üéÅ GiftGenius</h1>
                            <p>Find the perfect gift backed by real testimonials from men who got it right</p>
                            <div className="trust-indicators">
                                <div className="trust-indicator">
                                    <span>‚≠ê</span>
                                    <span>96% Success Rate</span>
                                </div>
                                <div className="trust-indicator">
                                    <span>‚ù§Ô∏è</span>
                                    <span>1,200+ Happy Partners</span>
                                </div>
                                <div className="trust-indicator">
                                    <span>üèÜ</span>
                                    <span>Expert Curated</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <div className="container">
                        {/* Analytics Dashboard */}
                        <div className="analytics-dashboard">
                            <div className="analytics-header">
                                <h3 className="analytics-title">
                                    üìä Your Gift Journey Analytics
                                </h3>
                                <select className="analytics-period">
                                    <option>Last 7 days</option>
                                    <option>Last 30 days</option>
                                    <option>All time</option>
                                </select>
                            </div>

                            <div className="analytics-grid">
                                <div className="analytics-card">
                                    <div className="analytics-value">{analyticsData.giftViews || 0}</div>
                                    <div className="analytics-label">Gifts Viewed</div>
                                    <div className={`analytics-change ${analyticsData.dailyGrowth?.giftViews >= 0 ? 'positive' : 'negative'}`}>
                                        {analyticsData.dailyGrowth?.giftViews >= 0 ? '+' : ''}{analyticsData.dailyGrowth?.giftViews || 0}%
                                    </div>
                                </div>

                                <div className="analytics-card">
                                    <div className="analytics-value">{analyticsData.wishlistAdds || 0}</div>
                                    <div className="analytics-label">Saved to Wishlist</div>
                                    <div className="analytics-change positive">+{analyticsData.conversionRates?.viewToWishlist || 0}% conversion</div>
                                </div>

                                <div className="analytics-card">
                                    <div className="analytics-value">{analyticsData.comparisons || 0}</div>
                                    <div className="analytics-label">Comparisons Made</div>
                                    <div className="analytics-change positive">+{analyticsData.conversionRates?.wishlistToComparison || 0}% from wishlist</div>
                                </div>

                                <div className="analytics-card">
                                    <div className="analytics-value">{analyticsData.externalClicks || 0}</div>
                                    <div className="analytics-label">Purchase Clicks</div>
                                    <div className="analytics-change positive">{analyticsData.conversionRates?.overallConversion || 0}% overall conversion</div>
                                </div>
                            </div>

                            <div className="analytics-chart">
                                üìà Conversion funnel visualization would go here
                            </div>
                        </div>

                        {/* Simple Gift Grid for Demo */}
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', gap: '24px' }}>
                            {gifts.slice(0, 6).map(gift => (
                                <div
                                    key={gift.id}
                                    style={{
                                        background: 'white',
                                        borderRadius: '12px',
                                        overflow: 'hidden',
                                        boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                                        cursor: 'pointer',
                                        transition: 'transform 0.3s ease'
                                    }}
                                    onClick={() => handleGiftClick(gift)}
                                >
                                    <img
                                        src={gift.image || '/api/placeholder/300/200'}
                                        alt={gift.name || gift.title}
                                        style={{ width: '100%', height: '200px', objectFit: 'cover' }}
                                    />
                                    <div style={{ padding: '18px' }}>
                                        <h3 style={{ marginBottom: '8px' }}>{gift.name || gift.title}</h3>
                                        <div style={{
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            marginBottom: '12px'
                                        }}>
                                            <span style={{
                                                fontSize: '1.4rem',
                                                color: 'var(--primary)',
                                                fontWeight: 'bold'
                                            }}>
                                                ${gift.price}
                                            </span>
                                            <span style={{ fontSize: '0.85rem', color: 'var(--gray-500)' }}>
                                                Free shipping
                                            </span>
                                        </div>
                                        <div style={{
                                            display: 'flex',
                                            gap: '8px',
                                            marginTop: '12px'
                                        }}>
                                            <button
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    addToWishlist(gift);
                                                }}
                                                style={{
                                                    flex: 1,
                                                    padding: '8px 12px',
                                                    background: 'var(--primary)',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '6px',
                                                    fontSize: '14px',
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                üíù Wishlist
                                            </button>
                                            <button
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    startComparison(gift);
                                                }}
                                                style={{
                                                    flex: 1,
                                                    padding: '8px 12px',
                                                    background: 'var(--info)',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '6px',
                                                    fontSize: '14px',
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                ‚öñÔ∏è Compare
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Floating Action Buttons */}
                    <div className="floating-actions">
                        <button
                            className="floating-btn"
                            onClick={() => setShowPurchaseJourney(true)}
                            title="Purchase Journey"
                        >
                            üõí
                        </button>
                        <button
                            className="floating-btn secondary"
                            onClick={() => {
                                const amount = prompt('Set your gift budget:');
                                if (amount && !isNaN(amount)) {
                                    setBudget(parseFloat(amount));
                                }
                            }}
                            title="Set Budget"
                        >
                            üí∞
                        </button>
                        <button
                            className="floating-btn tertiary"
                            onClick={() => {
                                const title = prompt('Add gift occasion:');
                                if (title) {
                                    const date = new Date();
                                    giftPlanner.addOccasion(date, title);
                                    analytics.trackEvent('occasion_planned', { title });
                                    updateAnalytics();
                                    showToast('Occasion Added', `${title} planned!`, 'success');
                                }
                            }}
                            title="Plan Gift"
                        >
                            üìÖ
                        </button>
                    </div>

                    {/* Purchase Journey Sidebar */}
                    {showPurchaseJourney && (
                        <div className="purchase-journey-sidebar open">
                            <div className="sidebar-header">
                                <h2>üõí Your Gift Journey</h2>
                                <button
                                    className="sidebar-close"
                                    onClick={() => setShowPurchaseJourney(false)}
                                >
                                    √ó
                                </button>
                            </div>

                            <div className="sidebar-content">
                                {/* Budget Tracker */}
                                <div className="sidebar-section">
                                    <h3>üí∞ Budget Tracker</h3>
                                    <div className="budget-tracker">
                                        <div className="budget-header">
                                            <span>Budget</span>
                                            <span className="budget-amount">${budgetStatus.total || 0}</span>
                                        </div>
                                        <div className="budget-progress">
                                            <div
                                                className="budget-progress-bar"
                                                style={{ width: `${Math.min(budgetStatus.percentUsed || 0, 100)}%` }}
                                            ></div>
                                        </div>
                                        <div className="budget-suggestion">
                                            {budgetStatus.suggestion || 'Set a budget to get started!'}
                                        </div>
                                    </div>
                                </div>

                                {/* Wishlist */}
                                <div className="sidebar-section">
                                    <h3>üíù Wishlist ({wishlist.length})</h3>
                                    {wishlist.length === 0 ? (
                                        <p style={{ color: 'var(--gray-500)', textAlign: 'center', padding: '20px' }}>
                                            No items in wishlist yet. Add some gifts!
                                        </p>
                                    ) : (
                                        wishlist.map(gift => (
                                            <div key={gift.id} className="wishlist-item">
                                                <img
                                                    src={gift.image || '/api/placeholder/60/60'}
                                                    alt={gift.name || gift.title}
                                                    className="wishlist-item-image"
                                                />
                                                <div className="wishlist-item-content">
                                                    <div className="wishlist-item-title">
                                                        {gift.name || gift.title}
                                                    </div>
                                                    <div className="wishlist-item-price">
                                                        ${gift.price}
                                                    </div>
                                                    <div className="wishlist-item-actions">
                                                        <button
                                                            className="wishlist-action-btn primary"
                                                            onClick={() => {
                                                                handleExternalClick(gift);
                                                                window.open(gift.buyLink || gift.link || '#', '_blank');
                                                            }}
                                                        >
                                                            Buy Now
                                                        </button>
                                                        <button
                                                            className="wishlist-action-btn"
                                                            onClick={() => startComparison(gift)}
                                                        >
                                                            Compare
                                                        </button>
                                                        <button
                                                            className="wishlist-action-btn"
                                                            onClick={() => removeFromWishlist(gift.id)}
                                                        >
                                                            Remove
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Gift Comparison Modal */}
                    {showComparison && (
                        <div className="comparison-modal">
                            <div className="comparison-content">
                                <div className="comparison-header">
                                    <h2>‚öñÔ∏è Gift Comparison</h2>
                                    <button
                                        className="comparison-close"
                                        onClick={() => setShowComparison(false)}
                                    >
                                        √ó
                                    </button>
                                </div>

                                <div className="comparison-grid">
                                    {comparisonGifts.map((gift, index) => (
                                        <div key={gift.id} className={`comparison-item ${index === 0 ? 'selected' : ''}`}>
                                            <img
                                                src={gift.image || '/api/placeholder/300/200'}
                                                alt={gift.name || gift.title}
                                                className="comparison-item-image"
                                            />
                                            <div className="comparison-item-content">
                                                <h4 className="comparison-item-title">{gift.name || gift.title}</h4>
                                                <div className="comparison-item-price">${gift.price}</div>

                                                <div className="comparison-pros-cons">
                                                    <div className="comparison-pros">
                                                        <h5>Pros</h5>
                                                        <ul className="comparison-list">
                                                            <li>High success rate ({gift.successRate || 90}%)</li>
                                                            <li>Free shipping</li>
                                                            <li>Great reviews</li>
                                                            {gift.price < 100 && <li>Budget-friendly</li>}
                                                        </ul>
                                                    </div>

                                                    <div className="comparison-cons">
                                                        <h5>Considerations</h5>
                                                        <ul className="comparison-list">
                                                            {gift.price > 200 && <li>Higher price point</li>}
                                                            <li>Limited availability</li>
                                                            <li>Delivery time varies</li>
                                                        </ul>
                                                    </div>
                                                </div>

                                                <button
                                                    className="comparison-select-btn"
                                                    onClick={() => {
                                                        addToWishlist(gift);
                                                        setShowComparison(false);
                                                    }}
                                                >
                                                    Select This Gift
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>