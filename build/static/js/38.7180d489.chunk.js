"use strict";(self.webpackChunkgiftgenius_frontend=self.webpackChunkgiftgenius_frontend||[]).push([[38],{38:(e,a,s)=>{s.r(a),s.d(a,{CameraScanner:()=>d,QuickScanButton:()=>m,default:()=>h,useCameraCapabilities:()=>c,useImageAnalysis:()=>i});var n=s(555),t=s(43),r=s(579);const c=()=>{const[e,a]=(0,t.useState)({hasCamera:!1,hasMultipleCameras:!1,supportsFacingMode:!1,supportsFlash:!1,supportsZoom:!1,maxResolution:null,error:null});return(0,t.useEffect)(()=>{(async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera not supported in this browser");const e=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind);a({hasCamera:e.length>0,hasMultipleCameras:e.length>1,supportsFacingMode:e.some(e=>e.label.includes("back")||e.label.includes("rear")),supportsFlash:"torch"in navigator,supportsZoom:!0,maxResolution:{width:1920,height:1080},devices:e,error:null})}catch(e){console.error("Camera capability detection failed:",e),a(a=>(0,n.A)((0,n.A)({},a),{},{error:e.message}))}})()},[]),e},i=()=>{const[e,a]=(0,t.useState)(!1),[s,n]=(0,t.useState)(null),[r,c]=(0,t.useState)(null);return{analyzeImage:(0,t.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a(!0),c(null);try{let a=e;e instanceof HTMLCanvasElement&&(a=e.toDataURL("image/jpeg",.8));const t=await l(a,s);return n(t),t}catch(t){return console.error("Image analysis failed:",t),c(t.message),null}finally{a(!1)}},[]),clearResults:(0,t.useCallback)(()=>{n(null),c(null)},[]),isAnalyzing:e,results:s,error:r}},l=async(e,a)=>{await new Promise(e=>setTimeout(e,1500+1e3*Math.random()));const s=.7+.25*Math.random(),n=["jewelry","clothing","electronics","books","art","home-decor","sports-equipment","beauty-products","toys","accessories"],t=["red","blue","green","yellow","black","white","pink","purple","gold","silver"],r=["Apple","Samsung","Nike","Adidas","Coach","Gucci","Sony","Generic"],c=n[Math.floor(Math.random()*n.length)],i=t[Math.floor(Math.random()*t.length)],l=r[Math.floor(Math.random()*r.length)];return{confidence:s,category:c,subcategories:[c,"gift-item"],colors:[i],brand:l,features:["high-quality","popular-item",i,"gift-worthy"],suggestedTags:[c,i,l.toLowerCase()],recommendations:o(c),timestamp:Date.now()}},o=e=>({jewelry:[{name:"Sterling Silver Necklace",price:89.99,match:95},{name:"Diamond Earrings",price:299.99,match:88},{name:"Gold Bracelet",price:149.99,match:82}],electronics:[{name:"Wireless Headphones",price:199.99,match:92},{name:"Smart Watch",price:299.99,match:87},{name:"Portable Speaker",price:79.99,match:85}],clothing:[{name:"Designer Scarf",price:59.99,match:90},{name:"Leather Jacket",price:199.99,match:85},{name:"Cashmere Sweater",price:129.99,match:88}]}[e]||[{name:"Similar Gift Item 1",price:49.99,match:85},{name:"Similar Gift Item 2",price:79.99,match:80},{name:"Similar Gift Item 3",price:99.99,match:75}]),d=e=>{let{onCapture:a,onAnalysis:s,onClose:n,facingMode:l="environment",className:o=""}=e;const[d,m]=(0,t.useState)(null),[h,u]=(0,t.useState)(!1),[p,g]=(0,t.useState)(!1),[x,j]=(0,t.useState)(1),[v,b]=(0,t.useState)(null),f=(0,t.useRef)(null),N=(0,t.useRef)(null),C=c(),{analyzeImage:y,clearResults:k,isAnalyzing:w,results:A,error:S}=i(),M=(0,t.useCallback)(async()=>{try{b(null);const e={video:{facingMode:l,width:{ideal:1920,max:1920},height:{ideal:1080,max:1080}}},a=await navigator.mediaDevices.getUserMedia(e);m(a),f.current&&(f.current.srcObject=a,await f.current.play(),u(!0))}catch(e){console.error("Failed to start camera:",e),b("Camera access failed: ".concat(e.message))}},[l]),I=(0,t.useCallback)(()=>{d&&(d.getTracks().forEach(e=>e.stop()),m(null),u(!1))},[d]),z=(0,t.useCallback)(async()=>{if(!f.current||!N.current)return;const e=f.current,n=N.current,t=n.getContext("2d");n.width=e.videoWidth,n.height=e.videoHeight,t.drawImage(e,0,0,n.width,n.height);const r=n.toDataURL("image/jpeg",.8),c=document.createElement("div");c.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: white;\n      z-index: 9999;\n      opacity: 0.8;\n      pointer-events: none;\n    ",document.body.appendChild(c),setTimeout(()=>{document.body.removeChild(c)},150);try{new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+Dto2QdCCuI0fPBdSUGJ3nI9NaOPAgTYbe").play().catch(()=>{})}catch(i){}if(a&&a(r,n),s){const e=await y(n);e&&s(e,r)}navigator.vibrate&&navigator.vibrate(50)},[a,s,y]),F=(0,t.useCallback)(async()=>{if(d)try{const e=d.getVideoTracks()[0];e.getCapabilities().torch&&(await e.applyConstraints({advanced:[{torch:!p}]}),g(!p))}catch(e){console.error("Flash toggle failed:",e)}},[d,p]),B=(0,t.useCallback)(async e=>{if(d)try{const a=d.getVideoTracks()[0],s=a.getCapabilities();if(s.zoom){const n=Math.max(s.zoom.min,Math.min(s.zoom.max,e));await a.applyConstraints({advanced:[{zoom:n}]}),j(n)}}catch(a){console.error("Zoom adjustment failed:",a)}},[d]);return(0,t.useEffect)(()=>(C.hasCamera&&!C.error&&M(),()=>{I()}),[C.hasCamera,C.error,M,I]),C.error?(0,r.jsx)("div",{className:"camera-scanner error ".concat(o),children:(0,r.jsxs)("div",{className:"error-message",children:[(0,r.jsx)("h3",{children:"Camera Unavailable"}),(0,r.jsx)("p",{children:C.error}),(0,r.jsx)("button",{onClick:n,children:"Close"})]})}):(0,r.jsxs)("div",{className:"camera-scanner ".concat(o),children:[(0,r.jsxs)("div",{className:"camera-container",children:[(0,r.jsx)("video",{ref:f,autoPlay:!0,playsInline:!0,muted:!0,className:"camera-video"}),(0,r.jsx)("canvas",{ref:N,style:{display:"none"}}),(0,r.jsxs)("div",{className:"camera-controls",children:[(0,r.jsxs)("div",{className:"control-row top",children:[C.supportsFlash&&(0,r.jsx)("button",{className:"control-btn flash ".concat(p?"active":""),onClick:F,disabled:!h,children:"\u26a1"}),(0,r.jsx)("button",{className:"control-btn close",onClick:n,children:"\u2715"})]}),(0,r.jsx)("div",{className:"control-row center",children:(0,r.jsx)("div",{className:"scan-frame",children:(0,r.jsxs)("div",{className:"scan-corners",children:[(0,r.jsx)("div",{className:"corner top-left"}),(0,r.jsx)("div",{className:"corner top-right"}),(0,r.jsx)("div",{className:"corner bottom-left"}),(0,r.jsx)("div",{className:"corner bottom-right"})]})})}),(0,r.jsxs)("div",{className:"control-row bottom",children:[C.supportsZoom&&(0,r.jsxs)("div",{className:"zoom-control",children:[(0,r.jsx)("button",{className:"zoom-btn",onClick:()=>B(Math.max(1,x-.5)),disabled:x<=1,children:"-"}),(0,r.jsxs)("span",{className:"zoom-indicator",children:[x.toFixed(1),"x"]}),(0,r.jsx)("button",{className:"zoom-btn",onClick:()=>B(Math.min(3,x+.5)),disabled:x>=3,children:"+"})]}),(0,r.jsx)("button",{className:"capture-btn",onClick:z,disabled:!h||w,children:w?(0,r.jsx)("div",{className:"analyzing-spinner"}):(0,r.jsx)("div",{className:"capture-ring",children:(0,r.jsx)("div",{className:"capture-inner"})})}),C.hasMultipleCameras&&(0,r.jsx)("button",{className:"control-btn flip-camera",onClick:()=>{I(),setTimeout(()=>{l="user"===l?"environment":"user",M()},100)},children:"\ud83d\udd04"})]})]}),(0,r.jsxs)("div",{className:"camera-instructions",children:[(0,r.jsx)("p",{children:"Point camera at item to scan"}),w&&(0,r.jsx)("p",{className:"analyzing-text",children:"Analyzing image..."})]})]}),A&&(0,r.jsx)("div",{className:"analysis-results-modal",children:(0,r.jsxs)("div",{className:"results-content",children:[(0,r.jsxs)("div",{className:"results-header",children:[(0,r.jsx)("h3",{children:"Item Identified!"}),(0,r.jsx)("button",{className:"close-results",onClick:()=>k(),children:"\u2715"})]}),(0,r.jsxs)("div",{className:"results-body",children:[(0,r.jsxs)("div",{className:"identification",children:[(0,r.jsxs)("h4",{children:["Category: ",A.category]}),(0,r.jsxs)("p",{children:["Confidence: ",Math.round(100*A.confidence),"%"]}),A.colors&&(0,r.jsxs)("p",{children:["Colors: ",A.colors.join(", ")]}),A.brand&&"Generic"!==A.brand&&(0,r.jsxs)("p",{children:["Brand: ",A.brand]})]}),(0,r.jsxs)("div",{className:"recommendations",children:[(0,r.jsx)("h4",{children:"Similar Gifts:"}),(0,r.jsx)("div",{className:"recommendation-list",children:A.recommendations.map((e,a)=>(0,r.jsxs)("div",{className:"recommendation-item",children:[(0,r.jsxs)("div",{className:"rec-info",children:[(0,r.jsx)("h5",{children:e.name}),(0,r.jsxs)("p",{className:"rec-price",children:["$",e.price]})]}),(0,r.jsxs)("div",{className:"match-score",children:[e.match,"% match"]})]},a))})]}),(0,r.jsxs)("div",{className:"results-actions",children:[(0,r.jsx)("button",{className:"btn-primary",onClick:()=>{s&&s(A),k()},children:"View All Matches"}),(0,r.jsx)("button",{className:"btn-secondary",onClick:z,children:"Scan Again"})]})]})]})}),S&&(0,r.jsxs)("div",{className:"analysis-error",children:[(0,r.jsxs)("p",{children:["Analysis failed: ",S]}),(0,r.jsx)("button",{onClick:()=>b(null),children:"Dismiss"})]})]})},m=e=>{let{onScanStart:a,className:s=""}=e;const[n,i]=(0,t.useState)(!1),l=c();return(0,t.useEffect)(()=>{i(l.hasCamera&&!l.error)},[l]),n?(0,r.jsxs)("button",{className:"quick-scan-btn ".concat(s),onClick:a,title:"Scan item with camera",children:[(0,r.jsxs)("div",{className:"scan-icon",children:[(0,r.jsx)("div",{className:"camera-body",children:"\ud83d\udcf7"}),(0,r.jsxs)("div",{className:"scan-lines",children:[(0,r.jsx)("div",{className:"scan-line"}),(0,r.jsx)("div",{className:"scan-line"}),(0,r.jsx)("div",{className:"scan-line"})]})]}),(0,r.jsx)("span",{children:"Scan Item"})]}):null},h={CameraScanner:d,QuickScanButton:m,useCameraCapabilities:c,useImageAnalysis:i}}}]);
//# sourceMappingURL=38.7180d489.chunk.js.map